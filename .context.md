# Project Context for AI Assistants

**Project Name:** Sport-Hub E-commerce Platform  
**Last Updated:** January 7, 2026

---

## Project Overview

Sport-Hub is a full-stack e-commerce web application for selling sports equipment (primarily football/soccer gear). The application includes a customer-facing storefront and a comprehensive admin dashboard for managing products, orders, inventory, and returns.

### Technology Stack

**Frontend:**

- React 18 with TypeScript
- Vite (build tool)
- TanStack Router (routing)
- TanStack Query (data fetching/caching)
- Tailwind CSS (styling)
- Lucide React (icons)

**Backend/Database:**

- Supabase (PostgreSQL database + Auth)
- Prisma ORM (schema management, migrations, seed data)
- Direct Supabase client for data operations (not using Prisma Client in production)

**Architecture:**

- Single Page Application (SPA)
- Client-side rendering
- Direct database access via Supabase client (no backend API server)
- Row Level Security (RLS) disabled for development

---

## Project Structure

```
/
â”œâ”€â”€ components/           # React components
â”‚   â”œâ”€â”€ admin/           # Admin dashboard components
â”‚   â”‚   â”œâ”€â”€ ProductManager.tsx       # Product & variant management
â”‚   â”‚   â”œâ”€â”€ ProductConfig.tsx        # Categories, brands, attributes
â”‚   â”‚   â”œâ”€â”€ OrderManager.tsx         # Order management
â”‚   â”‚   â”œâ”€â”€ ReturnManager.tsx        # Return request handling
â”‚   â”‚   â”œâ”€â”€ InventorySystem.tsx      # Stock tracking
â”‚   â”‚   â”œâ”€â”€ StockEntrySystem.tsx     # Inventory receiving
â”‚   â”‚   â”œâ”€â”€ StockIssueSystem.tsx     # Inventory issuing
â”‚   â”‚   â”œâ”€â”€ SupplierManager.tsx      # Supplier management
â”‚   â”‚   â”œâ”€â”€ SizeGuideManager.tsx     # Size guide management
â”‚   â”‚   â”œâ”€â”€ SystemAdmin.tsx          # System config & logs
â”‚   â”‚   â”œâ”€â”€ BusinessReports.tsx      # Analytics & reports
â”‚   â”‚   â”œâ”€â”€ DashboardHome.tsx        # Admin dashboard home
â”‚   â”‚   â””â”€â”€ SharedUI.tsx             # Shared admin UI components
â”‚   â”œâ”€â”€ common/          # Shared components
â”‚   â”œâ”€â”€ features/        # Feature-specific components
â”‚   â”‚   â”œâ”€â”€ cart/
â”‚   â”‚   â””â”€â”€ product/
â”‚   â””â”€â”€ layout/          # Layout components
â”œâ”€â”€ pages/               # Page components
â”‚   â”œâ”€â”€ HomePage.tsx
â”‚   â”œâ”€â”€ ProductListPage.tsx
â”‚   â”œâ”€â”€ ProductDetailPage.tsx
â”‚   â”œâ”€â”€ CartPage.tsx
â”‚   â”œâ”€â”€ CheckoutPage.tsx
â”‚   â”œâ”€â”€ OrderTrackingPage.tsx
â”‚   â”œâ”€â”€ OrderDetailPage.tsx
â”‚   â”œâ”€â”€ ProfilePage.tsx
â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”œâ”€â”€ AdminDashboard.tsx
â”‚   â””â”€â”€ PaymentGateway.tsx
â”œâ”€â”€ services/            # Service layer (Supabase operations)
â”‚   â”œâ”€â”€ index.ts                     # Category, Brand, Attribute services
â”‚   â”œâ”€â”€ product.service.ts           # Product CRUD operations
â”‚   â”œâ”€â”€ order.service.ts             # Order operations
â”‚   â”œâ”€â”€ return-request.service.ts    # Return request operations
â”‚   â”œâ”€â”€ system.service.ts            # System config operations
â”‚   â””â”€â”€ shared.service.ts            # Shared utilities
â”œâ”€â”€ lib/                 # Libraries & utilities
â”‚   â”œâ”€â”€ supabase.ts      # Supabase client
â”‚   â”œâ”€â”€ queryClient.ts   # TanStack Query client
â”‚   â”œâ”€â”€ prisma.ts        # Prisma client (used for seed only)
â”‚   â””â”€â”€ repositories/    # Prisma repositories (not used in production)
â”œâ”€â”€ hooks/               # Custom React hooks
â”‚   â”œâ”€â”€ useProductsQuery.ts
â”‚   â”œâ”€â”€ useOrdersQuery.ts
â”‚   â”œâ”€â”€ useInventoryQuery.ts
â”‚   â””â”€â”€ useCartQuery.ts
â”œâ”€â”€ context/             # React Context providers
â”‚   â”œâ”€â”€ AuthContext.tsx
â”‚   â””â”€â”€ CartContext.tsx
â”œâ”€â”€ types/               # TypeScript type definitions
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ constants/           # Enums and constants
â”‚   â””â”€â”€ enums.ts
â”œâ”€â”€ utils/               # Utility functions
â”‚   â””â”€â”€ helpers.ts
â”œâ”€â”€ prisma/              # Prisma schema & migrations
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”œâ”€â”€ seed.ts
â”‚   â””â”€â”€ migrations/
â””â”€â”€ public/              # Static assets
```

---

## Database Schema

**ðŸ“– Refer to `DATABASE_SCHEMA.md` for complete database documentation.**

### Key Tables

- **Product**: Main product catalog
- **ProductVariant**: Color/size combinations with individual SKUs
- **ProductAttribute**: Configurable attributes (color, size, material, etc.)
- **Category**: Product categories (hierarchical)
- **Brand**: Product brands
- **Order**: Customer orders
- **OrderItem**: Items in orders
- **ReturnRequest**: Return/exchange requests
- **User**: Customers and staff
- **SizeGuide**: Dynamic size guide charts

### Important Database Notes

1. **ProductAttribute.categoryIds**:

   - This is a **JSONB array** field added for Supabase client compatibility
   - Contains array of category IDs that this attribute applies to
   - Example: `["c1", "c2"]` means attribute applies to categories c1 and c2
   - When querying attributes for a category, use: `WHERE categoryIds @> '["categoryId"]'::jsonb`

2. **Many-to-Many Relationships**:

   - `Category â†” ProductAttribute` uses join table `_CategoryToProductAttribute`
   - For Supabase queries, use `ProductAttribute.categoryIds` field instead
   - Keep both in sync when updating attribute-category associations

3. **Timestamps**:

   - All tables have `createdAt` and `updatedAt`
   - Supabase does NOT auto-update `updatedAt` - must be set manually
   - Use `withUpdatedAt()` helper from `services/shared.service.ts`

4. **Enums**:
   - PostgreSQL enums: ProductStatus, OrderStatus, UserRole, PaymentMethod, etc.
   - Defined in `constants/enums.ts` and Prisma schema

---

## Key Features & Business Logic

### Product Management

- Products have multiple variants (color + size combinations)
- Each variant has unique SKU, stock quantity, price adjustment
- Variants can only be created through "Generate Variants" modal
- Duplicate variants (same color + size) are prevented
- Color and size values must come from ProductAttribute values
- Direct editing of variant color/size is disabled

### Order Flow

1. Customer adds items to cart
2. Checkout creates order with PENDING_PAYMENT status
3. Admin confirms payment â†’ PENDING_CONFIRMATION â†’ PACKING â†’ SHIPPING
4. Delivery completes â†’ COMPLETED
5. Customer can request return within return period

### Return/Exchange Process

1. Customer creates ReturnRequest with type REFUND or EXCHANGE
2. Uploads evidence images
3. Admin reviews and approves/rejects
4. For REFUND: Admin processes refund to bank account
5. For EXCHANGE: System creates new order with new variant

### Inventory Management

- **StockEntry**: Receiving inventory from suppliers
- **StockIssue**: Outgoing inventory (sales, transfers, adjustments)
- **Stocktake**: Inventory audits/cycle counts
- Stock is tracked at ProductVariant level

---

## Common Patterns

### Data Fetching (TanStack Query)

```typescript
const { data: products, isLoading } = useQuery({
  queryKey: ["products"],
  queryFn: () => productService.list(),
});
```

### Supabase Queries

```typescript
const { data, error } = await supabase
  .from("Product")
  .select("*, variants:ProductVariant(*), brand:Brand(*)")
  .eq("status", "ACTIVE");
```

### Image Handling

- All images have fallback URLs: `https://via.placeholder.com/...`
- Images use `onError` handlers to prevent broken image errors
- Base64 images are checked before rendering

### Error Handling

- Services use try-catch but do NOT throw errors
- Error states handled in UI components
- 401 errors indicate RLS issues (check Supabase permissions)

---

## Known Issues & Solutions

### Issue: "Could not find 'categoryIds' column"

**Cause:** Code uses `categoryIds` field but database only has many-to-many join table  
**Solution:** Migration added `categoryIds` JSONB field to ProductAttribute table  
**File:** `prisma/migrations/20250107_add_categoryids_to_productattribute/migration.sql`

### Issue: Image Loading Errors

**Cause:** Empty or invalid image URLs  
**Solution:** All `<img>` tags now have fallback URLs and onError handlers  
**Files:** ProductCard.tsx, ProductDetailPage.tsx, CartDrawer.tsx, etc.

### Issue: Uncaught Promise Rejections

**Cause:** Async functions not wrapped in try-catch  
**Solution:** Added try-catch blocks and .catch() handlers  
**Files:** Layout.tsx, ProductDetailPage.tsx

### Issue: 401 Unauthorized from Supabase

**Cause:** Row Level Security (RLS) policies blocking requests  
**Solution:** RLS disabled for development environment  
**Note:** Re-enable RLS for production with proper policies

---

## Development Workflow

### Database Changes

1. Update `prisma/schema.prisma`
2. Create migration: `npx prisma migrate dev --name migration_name`
3. Update seed data in `prisma/seed.ts` if needed
4. Run seed: `npx prisma db seed`
5. Regenerate Prisma client: `npx prisma generate`

### Adding New Features

1. Update TypeScript types in `types/index.ts`
2. Create/update service layer in `services/`
3. Create custom hooks if needed in `hooks/`
4. Build UI components
5. Update routes if needed

### Environment Setup

1. Copy `.env.example` to `.env`
2. Set Supabase credentials: `DATABASE_URL`, `DIRECT_URL`, `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`
3. Run migrations: `npx prisma migrate deploy`
4. Seed database: `npx prisma db seed`
5. Start dev server: `npm run dev`

---

## Troubleshooting Guide

### Database Errors

- Check `DATABASE_SCHEMA.md` for correct column names
- Verify migrations are applied: `npx prisma migrate status`
- Check Supabase dashboard for RLS policies and permissions

### Build Errors

- Clear cache: `rm -rf node_modules/.vite`
- Regenerate Prisma client: `npx prisma generate`
- Check for TypeScript errors: `npx tsc --noEmit`

### Runtime Errors

- Check browser console for specific errors
- Verify Supabase connection in Network tab
- Check authentication state in AuthContext

---

## Code Style & Conventions

### Naming

- Components: PascalCase (e.g., `ProductManager.tsx`)
- Files: camelCase for utilities, PascalCase for components
- Variables/functions: camelCase
- Constants/enums: UPPER_SNAKE_CASE
- Database columns: camelCase in Prisma, lowercase in PostgreSQL

### TypeScript

- Strict mode enabled
- Use interfaces for object types
- Use enums from `constants/enums.ts`
- Avoid `any` type - use proper typing

### React

- Functional components with hooks
- Use TanStack Query for server state
- Use React Context for global state (Auth, Cart)
- Memoize expensive computations with `useMemo`

### Supabase Queries

- Always include `.select()` to specify fields
- Use proper error handling
- Include necessary joins with `table:Table(*)`
- Filter early in the query chain

---

## Testing Checklist

Before deploying changes:

- [ ] Test all CRUD operations (Create, Read, Update, Delete)
- [ ] Check image loading with fallbacks
- [ ] Verify authentication flows
- [ ] Test order creation and status transitions
- [ ] Test return request workflows
- [ ] Verify inventory operations update stock correctly
- [ ] Check responsive design on mobile
- [ ] Test with and without JavaScript console errors

---

## Useful Commands

```bash
# Development
npm run dev                    # Start dev server
npm run build                  # Build for production
npm run preview                # Preview production build

# Database
npx prisma migrate dev         # Create and apply migration
npx prisma migrate deploy      # Apply migrations (production)
npx prisma db seed             # Run seed file
npx prisma generate            # Regenerate Prisma client
npx prisma studio              # Open Prisma Studio GUI

# Code Quality
npx tsc --noEmit              # Check TypeScript errors
npm run lint                   # Run ESLint (if configured)
```

---

## Key Files to Reference

- **DATABASE_SCHEMA.md**: Complete database schema documentation
- **prisma/schema.prisma**: Database schema definition
- **types/index.ts**: All TypeScript interfaces
- **constants/enums.ts**: All enum definitions
- **services/index.ts**: Category, Brand, Attribute services
- **components/admin/ProductManager.tsx**: Variant management logic

---

## Contact & Support

For questions about this project:

- Review `DATABASE_SCHEMA.md` for database questions
- Review this file for architecture questions
- Check git history for recent changes
- Review Supabase dashboard for runtime data

---

**Always read this context file and DATABASE_SCHEMA.md before making changes to ensure consistency with the existing architecture!**
